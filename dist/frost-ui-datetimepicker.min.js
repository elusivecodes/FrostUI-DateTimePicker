!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t:t(e)}(window,(function(e){"use strict";if(!e)throw new Error("FrostUI-DateTimePicker requires a Window.");if(!("UI"in e))throw new Error("FrostUI-DateTimePicker requires FrostUI.");if(!("DateTime"in e))throw new Error("FrostUI-DateTimePicker requires FrostDateTime.");const t=e.Core,s=e.dom,a=e.QuerySet,i=e.UI,n=e.DateTime,r=e.document;class d{constructor(e,a){this._node=e,this._settings=t.extend({},this.constructor.defaults,s.getDataset(this._node),a),this._useDayPeriod=this.constructor.checkDayPeriod(this._settings.locale),this._settings.format||(this._settings.format=this.constructor.getDefaultFormat(this._settings.locale,this._useDayPeriod)),this._checkFormat(),this._dateOptions={locale:this._settings.locale,timeZone:this._settings.timeZone},this._today=n.now(this._dateOptions);const i=s.getValue(this._node);switch(i?this._currentDate=n.fromFormat(this._settings.format,i,this._dateOptions):this._settings.defaultDate?this._currentDate=this._parseDate(this._settings.defaultDate):this._settings.useCurrent&&(this._currentDate=this._today.clone()),this._settings.viewDate?this._viewDate=this._parseDate(this._settings.viewDate):this._viewDate=this._today.clone(),this._settings.minDate&&(this._minDate=this._parseDate(this._settings.minDate)),this._settings.maxDate&&(this._maxDate=this._parseDate(this._settings.maxDate)),this._settings.enabledDates?this._enabledDates=this._parseDates(this._settings.enabledDates):this._settings.disabledDates&&(this._disabledDates=this._parseDates(this._settings.disabledDates)),this._settings.disabledDays&&(this._disabledDays=this._settings.disabledDays),this._settings.disabledHours&&(this._disabledHours=this._settings.disabledHours),this._settings.disabledTimeIntervals&&(this._disabledTimeIntervals=this._settings.disabledTimeIntervals.map(e=>this._parseDates(e)).filter(e=>2===e.length)),this._settings.minView){case"decade":this._viewMode="decade";break;case"year":this._viewMode="year";break;default:this._viewMode="month"}this._timeViewMode=null,this.update(),this._render(),this._events(),s.setData(this._node,"datetimepicker",this)}destroy(){s.removeData(this._node,"dropdown")}hide(){!this._animating&&s.hasClass(this._menuNode,"show")&&s.triggerOne(this._node,"hide.frost.datetimepicker")&&(this._animating=!0,s.fadeOut(this._menuNode,{duration:this._settings.duration}).then(e=>{s.removeClass(this._menuNode,"show"),s.setAttribute(this._node,"aria-expanded",!1),s.triggerEvent(this._node,"hidden.frost.datetimepicker")}).catch(e=>{}).finally(e=>{this._animating=!1}))}show(){this._animating||s.hasClass(this._menuNode,"show")||!s.triggerOne(this._node,"show.frost.datetimepicker")||(this._animating=!0,s.addClass(this._menuNode,"show"),s.fadeIn(this._menuNode,{duration:this._settings.duration}).then(e=>{s.setAttribute(this._node,"aria-expanded",!0),s.triggerEvent(this._node,"shown.frost.datetimepicker"),this._settings.focusOnShow&&s.focus(this._node)}).catch(e=>{}).finally(e=>{this._animating=!1}))}toggle(){s.hasClass(this._menuNode,"show")?this.hide():this.show()}static autoHide(e){const t=s.find(".datetimepicker.show");for(const a of t){const t=s.getDataset(a,"trigger"),i=s.findOne(t);if(i===e)continue;this.init(i).hide()}}static init(e,t){return s.hasData(e,"datetimepicker")?s.getData(e,"datetimepicker"):new this(e,t)}}Object.assign(d.prototype,{_events(){s.addEvent(this._node,"focus",e=>{this.show()}),s.addEvent(this._container,"click",e=>{e.stopPropagation()}),s.addEventDelegate(this._container,"click","[data-action]",e=>{const t=e.currentTarget,a=s.getDataset(t,"action"),i=!!this._currentDate;switch(a){case"setDate":i||(this._currentDate=this._today.clone()),this._currentDate.setYear(s.getDataset(t,"year"),s.getDataset(t,"month"),s.getDataset(t,"date")),this._viewDate=this._currentDate.clone(),this._refreshDate(),i||this._refreshTime(),this.update(),this._hasTime||this._settings.keepOpen||this.hide();break;case"nextTime":case"prevTime":this._currentDate||(this._currentDate=this._today.clone());const e="prevTime"===a?"sub":"add",n=this._currentDate.getDay();this._currentDate[e](1,s.getDataset(t,"unit")),i&&n===this._currentDate.getDay()||this._refreshDate(),this._refreshTime(),this.update();break;case"dayPeriod":this._currentDate||(this._currentDate=this._today.clone());const r=this._currentDate.getHours();this._currentDate.setHours(r+(r<12?12:-12)),i||this._refreshDate(),this._refreshTime(),this.update();break;case"setHours":this._currentDate||(this._currentDate=this._today.clone()),this._currentDate.setHours(s.getDataset(t,"hour")),this._timeViewMode=null,i||this._refreshDate(),this._refreshTime(),this.update();break;case"setMinutes":this._currentDate||(this._currentDate=this._today.clone()),this._currentDate.setMinutes(s.getDataset(t,"minute")),this._timeViewMode=null,i||this._refreshDate(),this._refreshTime(),this.update();break;case"changeView":this._viewMode=s.getDataset(t,"view"),s.hasDataset(t,"year")&&this._viewDate.setYear(s.getDataset(t,"year"),s.getDataset(t,"month")||1,s.getDataset(t,"date")||1),this._refreshDate();break;case"changeTimeView":this._timeViewMode=s.getDataset(t,"timeView"),this._refreshTime();break;case"showTime":s.setStyle(this._timeContainer,"display",""),s.squeezeIn(this._timeContainer,{duration:100}),s.squeezeOut(this._dateContainer,{duration:100}).then(e=>{s.setStyle(this._dateContainer,"display","none",!0)});break;case"showDate":s.setStyle(this._dateContainer,"display",""),s.squeezeIn(this._dateContainer,{duration:100}),s.squeezeOut(this._timeContainer,{duration:100}).then(e=>{s.setStyle(this._timeContainer,"display","none",!0)});break;case"next":case"prev":const d="prev"===a?"sub":"add";this._viewDate[d](s.getDataset(t,"amount")||1,s.getDataset(t,"unit")),this._refreshDate()}})}}),s.addEvent(r,"click.frost.datetimepicker",e=>{d.autoHide(e.target)}),s.addEvent(r,"keyup.frost.datetimepicker",e=>{switch(e.key){case"Tab":d.autoHide(e.target,!0);case"Escape":d.autoHide()}}),Object.assign(d.prototype,{_checkFormat(){this._hasDate=!1,this._hasTime=!1;const e=this._settings.format.matchAll(this.constructor._formatTokenRegExp);for(const t of e)if(t[1]&&(!this._hasDate&&this.constructor._dateTokenRegExp.test(t[1])&&(this._hasDate=!0),!this._hasTime&&this.constructor._timeTokenRegExp.test(t[1])&&(this._hasTime=!0),this._hasDate&&this._hasTime))break},_isDateBetween(e,t="second"){return(!this._minDate||!e.isBefore(this._minDate,t))&&(!this._maxDate||!e.isAfter(this._maxDate,t))},_isDateValid(e){if(!this._isDateBetween(e,"day"))return!1;if(this._disabledDays&&this._disabledDays.includes(e.getDay()))return!1;if(this._disabledDates&&this._disabledDates.find(t=>t.isSame(e,"day")))return!1;if(this._enabledDates&&!this._enabledDates.find(t=>t.isSame(e,"day")))return!1;if(this._disabledTimeIntervals){const t=e.clone().startOf("day"),s=e.clone().endOf("day");if(this._disabledTimeIntervals.find(([e,a])=>s.isSameOrAfter(e)&&t.isSameOrBefore(a)))return!1}return!0},_isTimeValid(e){return!!this._isDateBetween(e,"second")&&((!this._disabledHours||!this._disabledHours.includes(e.getHour()))&&((!this._disabledDays||!this._disabledDays.includes(e.getDay()))&&((!this._disabledDates||!this._disabledDates.find(t=>t.isSame(e,"day")))&&(!(this._enabledDates&&!this._enabledDates.find(t=>t.isSame(e,"day")))&&(!this._disabledTimeIntervals||!this._disabledTimeIntervals.find(([t,s])=>e.isSameOrAfter(t)&&e.isSameOrBefore(s)))))))},_parseDate(e){if(!e)return e;if(e instanceof n)return n.fromTimestamp(e.getTimestamp(),this._dateOptions);if(t.isString(e))try{return n.fromFormat(this._settings.format,e,this._dateOptions)}catch(t){return new n(e,this._dateOptions)}return e instanceof Date?n.fromDate(e,this._dateOptions):t.isNumber(e)?n.fromTimestamp(e,this._dateOptions):t.isArray(e)?n.fromArray(e,this._dateOptions):null},_parseDates(e){return e?e.map(e=>this._parseDate(e)).filter(e=>!!e):null}}),Object.assign(d.prototype,{refresh(){this._hasDate&&this._refreshDate(),this._hasTime&&this._refreshTime()},_createTable(e){const t=s.create("table",{class:"table table-sm text-center m-0"});if(e.borderless&&s.addClass(t,"table-borderless"),e.header){const a=s.create("thead");s.append(t,a);const i=s.create("tr");s.append(a,i);const n=s.create("td",{html:`<span class="${this._settings.icons.left}"></span>`,class:"action text-primary fw-bold",dataset:e.header.prev});e.header.prev||s.addClass(n,"disabled"),s.append(i,n);const r=s.create("td",{class:"fw-bold",text:e.header.title,attributes:{colspan:5},dataset:e.header.data});s.append(i,r),e.header.data&&s.addClass(r,"action"),e.header.wide&&s.addClass(r,"w-100");const d=s.create("td",{html:`<span class="${this._settings.icons.right}"></span>`,class:"action text-primary fw-bold",dataset:e.header.next});e.header.next||s.addClass(d,"disabled"),s.append(i,d),e.head&&e.head(a)}const a=s.create("tbody");if(s.append(t,a),e.timeActions){const e=s.create("tr");s.append(a,e);const t=s.create("td",{html:'<span class="icon-calendar"></span>',class:"action",attributes:{colspan:4},dataset:{action:"showDate"}});s.append(e,t)}if(e.body(a),e.dateActions){const e=s.create("tr");s.append(a,e);const t=s.create("td",{html:'<span. class="icon-clock"></>',class:"action",attributes:{colspan:7},dataset:{action:"showTime"}});s.append(e,t)}return t},_refreshDate(){switch(s.empty(this._dateContainer),this._viewMode){case"decade":this._renderDecade();break;case"year":this._renderYear();break;case"month":this._renderMonth()}},_refreshTime(){switch(s.empty(this._timeContainer),this._timeViewMode){case"day":this._renderDay();break;case"hour":this._renderHour();break;default:this._renderTime()}},_render(){this._menuNode=s.create("div",{class:"datetimepicker",dataset:{trigger:"#"+s.getAttribute(this._node,"id")}}),this._container=s.create("div",{class:"row row-cols-1 gy-0 gx-2"}),s.append(this._menuNode,this._container),this._hasDate&&(this._dateContainer=s.create("div",{class:"col d-flex align-items-center"}),s.append(this._container,this._dateContainer),this._refreshDate()),this._hasTime&&(this._timeContainer=s.create("div",{class:"col d-flex align-items-center"}),s.append(this._container,this._timeContainer),this._refreshTime()),this._hasDate&&this._hasTime&&(this._settings.sideBySide?(s.addClass(this._menuNode,"full"),s.addClass(this._container,"row-cols-md-2")):s.setStyle(this._timeContainer,"display","none",!0)),this._settings.inline?(s.addClass(this._menuNode,"inline"),s.after(this._node,this._menuNode),s.hide(this._node)):(s.addClass(this._menuNode,"shadow-sm"),s.append(r.body,this._menuNode),this._popper=new i.Popper(this._menuNode,{reference:this._node,placement:this._settings.placement,position:this._settings.position,fixed:this._settings.fixed,spacing:this._settings.spacing,minContact:this._settings.minContact}))},_renderDay(){const e=this._currentDate?this._currentDate:this._today,t=e.clone().startOf("day"),a=e.clone().endOf("day"),i=this._createTable({borderless:!0,body:e=>{const i=s.create("tr");s.append(e,i);const n=s.create("td",{class:"p-0",attributes:{colspan:7}});s.append(i,n);const r=s.create("div",{class:"row"});for(s.append(n,r);t.isSameOrBefore(a,"hour");){const e=s.create("div",{text:t.format("HH"),class:"action col-3 p-1",dataset:{action:"setHours",hour:t.getHours()}});s.append(r,e),this._isTimeValid(t)||s.addClass(e,"disabled"),t.add(1,"hour")}}});s.append(this._timeContainer,i)},_renderDecade(){const e=this._viewDate.clone().startOf("year"),t=this._viewDate.clone().endOf("year"),a=e.getYear(),i=a-a%10,n=i+9;e.setYear(i),t.setYear(n);const r=e.clone().sub(1,"year"),d=t.clone().add(1,"year");e.sub(1,"second"),t.add(1,"second");const o=this._createTable({header:{title:`${e.format("yyyy")} - ${t.format("yyyy")}`,wide:!0,prev:!!this._isDateBetween(e)&&{action:"prev",unit:"years",amount:10},next:!!this._isDateBetween(t)&&{action:"next",unit:"years",amount:10}},dateActions:!this._settings.sideBySide&&this._hasTime,body:e=>{const t=s.create("tr");s.append(e,t);const a=s.create("td",{class:"p-0",attributes:{colspan:7}});s.append(t,a);const o=s.create("div",{class:"row g-0"});for(s.append(a,o);r.isSameOrBefore(d,"month");){const e=r.getYear(),t=s.create("div",{text:r.format("yyyy"),class:"action col-4 p-1",dataset:"decade"===this._settings.minView?{action:"setDate",year:e}:{action:"changeView",view:"year",year:e}});s.append(o,t),this._currentDate&&this._currentDate.isSame(r,"year")?s.addClass(t,"active"):(e<i||e>n)&&s.addClass(t,"text-secondary"),this._isDateBetween(r,"year")||s.addClass(t,"disabled"),r.add(1,"year")}}});s.append(this._dateContainer,o)},_renderHour(){const e=this._currentDate?this._currentDate:this._today,t=e.clone().startOf("hour"),a=e.clone().endOf("hour"),i=this._createTable({borderless:!0,body:e=>{const i=s.create("tr");s.append(e,i);const n=s.create("td",{class:"p-0",attributes:{colspan:7}});s.append(i,n);const r=s.create("div",{class:"row"});for(s.append(n,r);t.isSameOrBefore(a,"minute");){const e=s.create("span",{text:t.format("mm"),class:"action col-3 p-1",dataset:{action:"setMinutes",minute:t.getMinutes()}});s.append(r,e),this._isTimeValid(t)||s.addClass(e,"disabled"),t.add(5,"minute")}}});s.append(this._timeContainer,i)},_renderMonth(){const e=this._viewDate.clone().startOf("month"),t=this._viewDate.clone().endOf("month"),a=e.clone().startOf("week"),i=t.clone().endOf("week");e.sub(1,"second"),t.add(1,"second");const n=this._createTable({header:{title:this._viewDate.format("MMMM yyyy"),data:{action:"changeView",view:"year"},prev:!!this._isDateBetween(e)&&{action:"prev",unit:"month"},next:!!this._isDateBetween(t)&&{action:"next",unit:"month"}},dateActions:!this._settings.sideBySide&&this._hasTime,head:e=>{const t=s.create("tr");s.append(e,t);const i=a.clone();for(let e=1;e<=7;e++){i.setWeekDay(e);const a=s.create("th",{class:"fw-bold",text:i.dayName("narrow")});s.append(t,a)}},body:e=>{let t;for(;a.isSameOrBefore(i,"day");){1===a.getWeekDay()&&(t=s.create("tr"),s.append(e,t));const i=s.create("td",{text:a.format("dd"),class:"action",dataset:{action:"setDate",year:a.getYear(),month:a.getMonth(),date:a.getDate()}});s.append(t,i),this._currentDate&&this._currentDate.isSame(a,"day")?s.addClass(i,"active"):this._viewDate.isSame(a,"month")||s.addClass(i,"text-secondary"),this._isDateValid(a)||s.addClass(i,"disabled"),this._today.isSame(a,"day")&&s.addClass(i,"today"),a.add(1,"day")}}});s.append(this._dateContainer,n)},_renderTime(){const e=this._currentDate?this._currentDate:this._today,t=this._createTable({borderless:!0,timeActions:!this._settings.sideBySide&&this._hasDate,body:t=>{const a=s.create("tr");s.append(t,a);const i=s.create("tr");s.append(t,i);const n=s.create("tr");s.append(t,n);const r=e.clone().add(1,"hour"),d=!!this._isTimeValid(r)&&{action:"nextTime",unit:"hour"},o=s.create("td",{html:`<span class="${this._settings.icons.up}"></span>`,class:"action text-primary bw-bold py-4 px-0",dataset:d});d||s.addClass(o,"disabled"),s.append(a,o);const h=s.create("td",{text:e.format(this._useDayPeriod?"hh":"HH"),class:"action time py-2 px-0",style:{width:"35%"},dataset:{action:"changeTimeView",timeView:"day"}});s.append(i,h);const c=e.clone().sub(1,"hour"),l=!!this._isTimeValid(c)&&{action:"prevTime",unit:"hour"},_=s.create("td",{html:`<span class="${this._settings.icons.down}"></span>`,class:"action text-primary bw-bold py-4 px-0",dataset:l});l||s.addClass(_,"disabled"),s.append(n,_);const u=s.create("td",{style:{width:"5%"}});s.append(a,u);const m=s.create("td",{text:":",class:"time py-2"});s.append(i,m);const p=s.create("td");s.append(n,p);const D=e.clone().add(1,"minute"),y=!!this._isTimeValid(D)&&{action:"nextTime",unit:"minute"},f=s.create("td",{html:`<span class="${this._settings.icons.up}"></span>`,class:"action text-primary bw-bold py-4 px-0",style:{width:"35%"},dataset:y});y||s.addClass(f,"disabled"),s.append(a,f);const g=s.create("td",{text:e.format("mm"),class:"action time py-2 px-0",dataset:{action:"changeTimeView",timeView:"hour"}});s.append(i,g);const b=e.clone().sub(1,"minute"),w=!!this._isTimeValid(b)&&{action:"prevTime",unit:"minute"},T=s.create("td",{html:`<span class="${this._settings.icons.down}"></span>`,class:"action text-primary bw-bold py-4 px-0",dataset:w});if(w||s.addClass(T,"disabled"),s.append(n,T),this._useDayPeriod){const t=s.create("td",{style:{width:"25%"}});s.append(a,t);const r=s.create("td");s.append(i,r);const d=e.getHours(),o=e.clone().setHours(d+(d<12?12:-12)),h=!!this._isTimeValid(o)&&{action:"dayPeriod"},c=s.create("span",{text:e.format("aa").toUpperCase(),class:"btn btn-primary d-block",dataset:h});h||s.addClass(c,"disabled"),s.append(r,c);const l=s.create("td");s.append(n,l)}}});s.append(this._timeContainer,t)},_renderYear(){const e=this._viewDate.clone().startOf("year"),t=this._viewDate.clone().endOf("year"),a=e.clone(),i=t.clone();e.sub(1,"second"),t.add(1,"second");const n=this._createTable({header:{title:this._viewDate.format("yyyy"),wide:!0,data:{action:"changeView",view:"decade"},prev:!!this._isDateBetween(e)&&{action:"prev",unit:"year"},next:!!this._isDateBetween(t)&&{action:"next",unit:"year"}},dateActions:!this._settings.sideBySide&&this._hasTime,body:e=>{const t=s.create("tr");s.append(e,t);const n=s.create("td",{class:"p-0",attributes:{colspan:7}});s.append(t,n);const r=s.create("div",{class:"row g-0"});for(s.append(n,r);a.isSameOrBefore(i,"month");){const e=s.create("div",{text:a.format("MMM"),class:"action col-4 p-1",dataset:"year"===this._settings.minView?{action:"setDate",year:a.getYear(),month:a.getMonth()}:{action:"changeView",view:"month",year:a.getYear(),month:a.getMonth()}});s.append(r,e),this._currentDate&&this._currentDate.isSame(a,"month")&&s.addClass(e,"active"),this._isDateBetween(a,"month")||s.addClass(e,"disabled"),a.add(1,"month")}}});s.append(this._dateContainer,n)}}),Object.assign(d,{_dayPeriods:{},_defaultFormats:{},checkDayPeriod(e){if(!(e in this._dayPeriods)){const t=new Intl.DateTimeFormat(e,{hour:"2-digit"});this._dayPeriods[e]=t.formatToParts(new Date).find(e=>"dayPeriod"===e.type)}return this._dayPeriods[e]},getDefaultFormat(e,t){if(!(e in this._defaultFormats)){const s=new Intl.DateTimeFormat(e,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});this._defaultFormats[e]=s.formatToParts(new Date).map((e,s,a)=>{switch(e.type){case"year":return"yyyy";case"month":return"MM";case"day":return"dd";case"hour":return t?"hh":"HH";case"minute":return"mm";case"second":return"";case"dayPeriod":return"a"}return s<a.length-1&&"second"===a[s+1].type?"":", "===e.value?" ":/[a-z]/i.test(e.value)?`'${e.value}'`:e.value}).join("")}return this._defaultFormats[e]}}),Object.assign(d.prototype,{getDate(){return this._currentDate?this._currentDate.clone():null},getDisabledDates(){return this._disabledDates},getDisabledDays(){return this._disabledDays},getDisabledHours(){return this._disabledHours},getDisabledTimeIntervals(){return this._disabledTimeIntervals},getEnabledDates(){return this._enabledDates},setDate(e){return this._currentDate=this._parseDate(e),this.update(),this.refresh(),this},setDisabledDates(e){return this._disabledDates=this._parseDates(e),this._enabledDates=null,this.update(),this.refresh(),this},setDisabledDays(e){return this._disabledDays=e,this.update(),this.refresh(),this},setDisabledHours(e){return this._disabledHours=e,this.update(),this.refresh(),this},setDisabledTimeIntervals(){return this._disabledTimeIntervals=disabledTimeIntervals,this.update(),this.refresh(),this},setEnabledDates(e){return this._enabledDates=this._parseDates(e),this._disabledDates=null,this.update(),this.refresh(),this},setMaxDate(e){return this._maxDate=this._parseDate(e),this.update(),this.refresh(),this},setMinDate(e){return this._minDate=this._parseDate(e),this.update(),this.refresh(),this},setViewDate(e){return this._viewDate=this._parseDate(e),this.refresh(),this},update(){return this._currentDate?(s.setValue(this._node,this._currentDate.format(this._settings.format)),this):this}}),d.defaults={format:null,locale:DateFormatter.defaultLocale,timeZone:n.defaultTimeZone,defaultDate:null,minDate:null,maxDate:null,enabledDates:null,disabledDates:null,enabledDays:null,disabledDays:null,enabledHours:null,disabledHours:null,disabledTimeIntervals:null,icons:{up:"icon-arrow-up",right:"icon-arrow-right",down:"icon-arrow-down",left:"icon-arrow-left"},buttons:{},keyBinds:{},useCurrent:!1,keepOpen:!1,focusOnShow:!1,minView:null,inline:!1,sideBySide:!1,display:"dynamic",duration:100,placement:"bottom",position:"start",fixed:!1,spacing:3,minContact:!1},d._formatTokenRegExp=/([a-z])\1*|'[^']*'/gi,d._dateTokenRegExp=/[GyYqQMLwWdDFEec]/,d._timeTokenRegExp=/[ahHKkmsS]/,a&&(a.prototype.dateTimePicker=function(e,...s){let a,i;t.isObject(e)?a=e:t.isString(e)&&(i=e);for(const e of this){if(!t.isElement(e))continue;const n=d.init(e,a);i&&n[i](...s)}return this}),i.DateTimePicker=d}));