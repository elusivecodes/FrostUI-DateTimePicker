!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@fr0st/query"),require("@fr0st/ui"),require("@fr0st/datetime")):"function"==typeof define&&define.amd?define(["exports","@fr0st/query","@fr0st/ui","@fr0st/datetime"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).UI=t.UI||{},t.fQuery,t.UI,t.DateTime)}(this,(function(t,e,s,i){"use strict";const a={},n={},o={},r={};function h(t,e,s){return new Intl.DateTimeFormat(t,e).formatToParts(new Date).map((t=>{switch(t.type){case"year":return"yyyy";case"month":return"MM";case"day":return"dd";case"hour":return s?"hh":"HH";case"minute":return"mm";case"dayPeriod":return"a"}return", "===t.value?" ":/[a-z]/i.test(t.value)?`'${t.value}'`:t.value})).join("")}class d extends s.BaseComponent{constructor(t,s){var i;super(t,s),this._dateOptions={locale:this._options.locale||DateTime.getDefaultLocale(),timeZone:this._options.timeZone||DateTime.getDefaultTimeZone()},this._options.minDate&&(this._minDate=this._parseDate(this._options.minDate)),this._options.maxDate&&(this._maxDate=this._parseDate(this._options.maxDate)),this._useDayPeriod=function(t){if(!(t in a)){const e=new Intl.DateTimeFormat(t,{hour:"2-digit"});a[t]=!!e.formatToParts(new Date).find((t=>"dayPeriod"===t.type))}return a[t]}(this._dateOptions.locale),this._options.format||(this._options.format=this._options.multiDate?(i=this._dateOptions.locale,this._useDayPeriod,i in o||(o[i]=h(i,{year:"numeric",month:"2-digit",day:"2-digit"})),o[i]):function(t,e){return t in n||(n[t]=h(t,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"},e)),n[t]}(this._dateOptions.locale,this._useDayPeriod)),this._checkFormat();const r=e.getValue(this._node);if(this._options.multiDate?this._dates=[...new Set(r.split(this._options.multiDateSeparator))].map((t=>this._makeDate(t))).filter((t=>t&&this._isValid(t))):(this._date=this._makeDate(r),!this._date&&this._options.useCurrent&&(this._date=this._now()),this._date&&!this._isValid(this._date)&&(this._date=null)),this._options.defaultDate&&(this._defaultDate=this._parseDate(this._options.defaultDate)),this._defaultDate||(this._defaultDate=this._now()),this._hasHours&&!this._isValid(this._defaultDate)){let t=this._defaultDate.startOf("day");const e=this._defaultDate.endOf("day");for(;t.isBefore(e);){if(this._isValid(t)){this._defaultDate=t;break}t=t.add(5,"minutes")}}this._options.inline?this._options.modal=!1:!this._options.modal&&this._options.mobileModal&&(this._options.modal=/Android|webOS|iPhone|iPad|iPod/i.test(navigator.userAgent)),(this._date||this._options.multiDate&&this._dates.length||r&&!this._options.keepInvalid)&&this._updateValue(),this._render(),this._events(),this._resetView(),this._options.modal?(this._renderModal(),this._eventsModal()):this._options.inline&&this._refresh(),this._refreshDisabled(),e.setData(this._menuNode,{input:this._node})}disable(){e.setAttribute(this._node,{disabled:!0}),this._refreshDisabled(),this._refresh()}clear(){this.setDate(null)}dispose(){this._popper&&(this._popper.dispose(),this._popper=null),this._modal&&(s.Modal.init(this._modal).dispose(),this._modal=null,this._setBtn=null,this._toolbarYear=null,this._toolbarDate=null,this._toolbarTime=null),e.removeEvent(this._node,"change.ui.datetimepicker"),e.removeEvent(this._node,"input.ui.datetimepicker"),e.removeEvent(this._node,"click.ui.datetimepicker"),e.removeEvent(this._node,"focus.ui.datetimepicker"),e.removeEvent(this._node,"keydown.ui.datetimepicker"),e.removeEvent(this._node,"keyup.ui.datetimepicker"),e.remove(this._menuNode),this._date=null,this._dates=null,this._minDate=null,this._maxDate=null,this._viewDate=null,this._defaultDate=null,this._dateOptions=null,this._menuNode=null,this._container=null,this._dateContainer=null,this._timeContainer=null,this._showTimeTable=null,this._showDateTable=null,this._closeTable=null,super.dispose()}enable(){e.removeAttribute(this._node,"disabled"),this._refreshDisabled(),this._refresh()}getDate(){return this._options.multiDate?this._dates.slice():this._date}getMaxDate(){return this._maxDate?this._maxDate:null}getMinDate(){return this._minDate?this._minDate:null}getViewDate(){return this._viewDate}hide(){if(this._options.inline)return;if(this._options.modal)return void s.Modal.init(this._modal).hide();if(!e.isConnected(this._menuNode)||e.getDataset(this._menuNode,"uiAnimating")||!e.triggerOne(this._node,"hide.ui.datetimepicker"))return;e.setDataset(this._menuNode,{uiAnimating:"out"});const t=e.find("[tabindex]",this._menuNode);e.setAttribute(t,{tabindex:-1}),e.fadeOut(this._menuNode,{duration:this._options.duration}).then((t=>{this._popper.dispose(),this._popper=null,e.detach(this._menuNode),e.removeDataset(this._menuNode,"uiAnimating"),e.triggerEvent(this._node,"hidden.ui.datetimepicker")})).catch((t=>{"out"===e.getDataset(this._menuNode,"uiAnimating")&&e.removeDataset(this._menuNode,"uiAnimating")}))}refresh(){this._options.multiDate?this._setDates(this._dates):this._setDate(this._date)}setDate(t){if(this._options.multiDate){const e=this._parseDates(t);this._setDates(e)}else t=this._parseDate(t),this._setDate(t)}setMaxDate(t){this._maxDate=this._parseDate(t),this.refresh()}setMinDate(t){this._minDate=this._parseDate(t),this.refresh()}show(){if(!this._options.inline&&!e.isConnected(this._menuNode)&&this._isEditable()){if(this._options.modal){if(this._options.appendTo)e.append(this._options.appendTo,this._modal);else{const t=e.closest(this._node,".modal").shift();t?e.after(t,this._modal):e.after(this._node,this._modal)}this._resetView(),this._refresh();const t=s.Modal.init(this._modal);return this._activeTarget&&(t._activeTarget=this._activeTarget),void t.show()}!e.getDataset(this._menuNode,"uiAnimating")&&e.triggerOne(this._node,"show.ui.datetimepicker")&&(e.setDataset(this._menuNode,{uiAnimating:"in"}),this._options.appendTo?e.append(this._options.appendTo,this._menuNode):e.after(this._node,this._menuNode),this._resetView(),this._refresh(),this._popper=new s.Popper(this._menuNode,{reference:this._node,placement:this._options.placement,position:this._options.position,fixed:this._options.fixed,spacing:this._options.spacing,minContact:this._options.minContact}),e.fadeIn(this._menuNode,{duration:this._options.duration}).then((t=>{e.removeDataset(this._menuNode,"uiAnimating"),e.triggerEvent(this._node,"shown.ui.datetimepicker")})).catch((t=>{"in"===e.getDataset(this._menuNode,"uiAnimating")&&e.removeDataset(this._menuNode,"uiAnimating")})))}}toggle(){e.isConnected(this._menuNode)?this.hide():this.show()}update(){this._popper&&this._popper.update()}}function c(t,e){return u(t,e)||b(t,e)&&t.getMonth()>e.getMonth()}function u(t,e){return t.getYear()>e.getYear()}function l(t,e){return m(t,e)||b(t,e)&&t.getMonth()<e.getMonth()}function _(t,e){return t.getTimestamp()<e.getTimestamp()}function m(t,e){return t.getYear()<e.getYear()}function p(t,e){return f(t,e)&&t.getDate()===e.getDate()}function f(t,e){return b(t,e)&&t.getMonth()===e.getMonth()}function D(t,e){return t.getTimestamp()===e.getTimestamp()}function b(t,e){return t.getYear()===e.getYear()}d.defaults={format:null,altFormats:[],ariaFormat:"MMMM d, yyyy",timeZone:null,locale:null,defaultDate:null,minDate:null,maxDate:null,isValidDay:null,isValidMonth:null,isValidTime:null,isValidYear:null,renderDay:null,renderMonth:null,renderYear:null,multiDate:!1,multiDateSeparator:",",minuteStepping:1,useCurrent:!1,keepOpen:!1,inline:!1,sideBySide:!1,vertical:!1,showToolbar:!1,showClose:!1,keepInvalid:!1,ignoreReadonly:!1,modal:!1,mobileModal:!0,duration:100,appendTo:null,placement:"bottom",position:"start",fixed:!1,spacing:0,minContact:!1},d.classes={action:"datetimepicker-action",active:"datetimepicker-active",column:"col d-flex flex-column",container:"row row-cols-1 g-2",containerColumns:"row-cols-lg-2",dateColumn:"col-4 px-1 py-2",days:"text-primary small fw-light",disabled:"datetimepicker-disabled",hourColumn:"col-3 p-1",menu:"datetimepicker",menuInline:"datetimepicker-inline",menuShadow:"shadow-sm",menuWide:"datetimepicker-wide",modal:"modal",modalBody:"modal-body",modalBtnContainer:"text-end mt-4",modalBtnPrimary:"btn btn-primary ripple ms-2",modalBtnSecondary:"btn btn-secondary ripple ms-2",modalContent:"modal-content",modalDialog:"modal-dialog modal-sm",modalHeader:"modal-header",modalTitle:"modal-title",navigation:"text-primary fs-5 lh-1",periodButton:"btn btn-primary d-block",row:"row g-0",rowContainer:"p-0",spacingNav:"py-2",spacingSeparator:"py-2",spacingTime:"py-2 px-0",spacingTimeNav:"py-4 px-0",table:"table table-borderless table-sm text-center mx-0 my-auto",tertiary:"text-body-tertiary",time:"datetimepicker-time",timeColumn:"col-3 px-1 py-2",title:"fw-bold",titleWide:"w-100",today:"datetimepicker-today",toolbarDate:"fs-3 mb-0",toolbarRow:"d-flex align-items-end justify-content-between",toolbarPadding:"p-3",toolbarTime:"fs-3 mb-0",toolbarYear:"small text-body-secondary mb-0"},d.lang={cancel:"Cancel",close:"Close",decrementHour:"Decrement Hour",decrementMinute:"Decrement Minute",incrementHour:"Increment Hour",incrementMinute:"Increment Minute",nextDecade:"Next Decade",nextMonth:"Next Month",nextYear:"Next Year",prevDecade:"Previous Decade",prevMonth:"Previous Month",prevYear:"Previous Year",selectDate:"Select Date",selectDateTime:"Select Date & Time",selectHour:"Select Hour",selectMinute:"Select Minute",selectMonth:"Select Month",selectTime:"Select Time",selectYear:"Select Year",set:"Set",togglePeriod:"Toggle Period"},d.icons={close:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" viewBox="0 0 24 24"><title>check</title><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z" fill="currentColor" /></svg>',date:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1" fill="currentColor"/></svg>',down:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M7.41 8.58L12 13.17l4.59-4.59L18 10l-6 6l-6-6l1.41-1.42z" fill="currentColor"/></svg>',left:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M15.41 16.58L10.83 12l4.58-4.59L14 6l-6 6l6 6l1.41-1.42z" fill="currentColor"/></svg>',right:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12L8.59 7.41L10 6l6 6l-6 6l-1.41-1.42z" fill="currentColor"/></svg>',time:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8a8 8 0 0 0-8-8a8 8 0 0 0-8 8a8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10a10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67l-.75 1.23L11 13V7h1.5z" fill="currentColor"/></svg>',up:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6l1.41 1.41z" fill="currentColor"/></svg>'},d._createTable=function(t){const s=e.create("table",{class:this.classes.table});if(t.header){const i=e.create("thead");e.append(s,i);const a=e.create("tr");e.append(i,a);const n=e.create("th",{html:this.icons.left,class:this.classes.navigation});t.header.prev?(e.addClass(n,this.classes.action),e.setDataset(n,t.header.prev.dataset),e.setAttribute(n,{role:"button",tabindex:0,...t.header.prev.attributes})):e.addClass(n,this.classes.disabled),e.append(a,n);const o=e.create("th",{class:this.classes.title,text:t.header.title,attributes:{colspan:5,...t.header.attributes}});t.header.dataset&&(e.addClass(o,this.classes.action),e.setDataset(o,t.header.dataset),e.setAttribute(o,{role:"button",tabindex:0})),t.header.wide&&e.addClass(o,this.classes.titleWide),e.append(a,o);const r=e.create("th",{html:this.icons.right,class:this.classes.navigation});t.header.next?(e.addClass(r,this.classes.action),e.setDataset(r,t.header.next.dataset),e.setAttribute(r,{role:"button",tabindex:0,...t.header.next.attributes})):e.addClass(r,this.classes.disabled),e.append(a,r),t.head&&t.head(i)}const i=e.create("tbody");return e.append(s,i),t.body(i),s},d._renderTimeColumn=function(t){const s=e.create("td",{html:this.icons.up,class:[this.classes.navigation,this.classes.time,this.classes.spacingTimeNav],style:{width:`${t.cellWidth}%`}});t.increment?(e.addClass(s,this.classes.action),e.setDataset(s,t.increment.dataset),e.setAttribute(s,{role:"button",tabindex:0,...t.increment.attributes})):e.addClass(s,this.classes.disabled),e.append(t.upTr,s);const i=e.create("td",{text:t.select.text,class:[this.classes.action,this.classes.time,this.classes.spacingTime],dataset:t.select.dataset,attributes:{role:"button",tabindex:0,...t.select.attributes}});e.append(t.timeTr,i);const a=e.create("td",{html:this.icons.down,class:[this.classes.navigation,this.classes.time,this.classes.spacingTimeNav]});t.decrement?(e.addClass(a,this.classes.action),e.setDataset(a,t.decrement.dataset),e.setAttribute(a,{role:"button",tabindex:0,...t.decrement.attributes})):e.addClass(a,this.classes.disabled),e.append(t.downTr,a)},d._renderTimeSeparator=function(t){const s=e.create("td",{style:{width:`${t.separatorWidth}%`}});e.append(t.upTr,s);const i=e.create("td",{text:":",class:[this.classes.time,this.classes.spacingSeparator]});e.append(t.timeTr,i);const a=e.create("td");e.append(t.downTr,a)};const g=d.prototype;g._checkFormat=function(){this._hasYear=!1,this._hasMonth=!1,this._hasDate=!1,this._hasHours=!1,this._hasMinutes=!1;const t=this._options.format.matchAll(/([a-z])\1*|'[^']*'/gi);for(const e of t)if(e[1])switch(e[1]){case"y":case"Y":this._hasYear=!0;break;case"M":case"L":this._hasMonth=!0;break;case"d":case"D":this._hasDate=!0;break;case"h":case"H":case"K":case"k":this._hasHours=!0;break;case"m":this._hasMinutes=!0}if(this._hasDate&&!this._hasMonth)throw new Error("Date selector requires a month.");if(this._hasMonth&&!this._hasYear)throw new Error("Month selector requires a year.");if(this._hasMinutes&&!this._hasHours)throw new Error("Minute selector requires hours.");if(this._hasHours&&this._hasYear&&!this._hasDate)throw new Error("Date/time selector requires a day of month.");if(this._hasHours&&this._options.multiDate)throw new Error("Time selector cannot be used with multiDate option.");this._hasDate?this._minView="days":this._hasMonth?this._minView="months":this._hasYear&&(this._minView="years")},g._clampDate=function(t){return this._isAfterMin(t)||(t=t.setTimestamp(this._minDate.getTimestamp())),this._isBeforeMax(t)||(t=t.setTimestamp(this._maxDate.getTimestamp())),t},g._clampStepping=function(t){if(!this._hasMinutes||1==this._options.minuteStepping)return t;const s=t.getMinutes(),i=Math.min(e._toStep(s,this._options.minuteStepping),60);return s!==i?t.setMinutes(i):t},g._events=function(){e.addEvent(this._node,"change.ui.datetimepicker",(t=>{if(t.skipUpdate)return;const s=e.getValue(this._node);if(this._options.multiDate){const t=s.split(this._options.multiDateSeparator),e=[...new Set(t)].map((t=>this._makeDate(t))).filter((t=>t&&this._isValid(t)));e.length===t.length?this._setDates(e):!this._options.keepInvalid&&s?e.length?this._setDates(e):this._setDates(this._dates):(this._dates=e,this._refresh())}else{const t=this._makeDate(s);t&&this._isValid(t)?this._setDate(t):!this._options.keepInvalid&&s?this._setDate(this._date):(this._date=null,this._refresh())}})),this._hasYear&&this._eventsDate(),this._hasHours&&this._eventsTime(),e.addEvent(this._menuNode,"click.ui.datetimepicker",(t=>{t.stopPropagation()})),this._options.inline||(e.addEvent(this._node,"input.ui.datetimepicker",(t=>{const s=e.getValue(this._node);if(this._options.multiDate){const t=s.split(this._options.multiDateSeparator),e=[...new Set(t)].map((t=>this._makeDate(t))).filter((t=>t&&this._isValid(t)));e.length&&(this._dates=e,this._refresh())}else{const t=this._makeDate(s);t&&this._isValid(t)&&(this._date=t,this._refresh())}})),e.addEvent(this._node,"click.ui.datetimepicker",(t=>{"in"!==e.getDataset(this._menuNode,"uiAnimating")&&(this._options.modal?this._activeTarget=this._node:(e.stop(this._menuNode),e.removeDataset(this._menuNode,"uiAnimating")),this.show())})),this._options.modal||(e.addEvent(this._node,"focus.ui.datetimepicker",(t=>{e.isSame(this._node,document.activeElement)&&(e.stop(this._menuNode),e.removeDataset(this._menuNode,"uiAnimating"),this.show())})),e.addEvent(this._menuNode,"keydown.ui.datetimepicker",(t=>{if("Tab"!==t.code)return;const s=e.find('[tabindex="0"]',this._menuNode),i=e.indexOf(s,t.target);t.shiftKey&&0===i?(t.preventDefault(),e.focus(this._node)):t.shiftKey||i!==s.length-1||(e.focus(this._node),this.hide())}))),e.addEvent(this._node,"keydown.ui.datetimepicker",(t=>{switch(t.code){case"Enter":case"NumpadEnter":t.preventDefault(),this.toggle();break;case"Escape":e.isConnected(this._menuNode)&&(t.stopPropagation(),this.hide());break;case"Tab":if(t.shiftKey&&!this._options.modal&&e.isConnected(this._menuNode))this.hide();else if(!t.shiftKey&&!this._options.modal&&e.isConnected(this._menuNode)&&!e.getDataset(this._menuNode,"uiAnimating")){t.preventDefault();const s=e.findOne('[tabindex="0"]',this._menuNode);e.focus(s)}}})))},g._eventsDate=function(){const t=!this._options.modal,s=t=>{let s;if(this._hasHours?s='[data-ui-action="changeView"][data-ui-time-view="hours"]':this._hasMinutes?s='[data-ui-action="changeView"][data-ui-time-view="minutes"]':this._useDayPeriod&&(s='[data-ui-action="togglePeriod"]'),s){const t=e.findOne(s,this._timeContainer);e.focus(t)}},i=t=>{this._timeViewMode=null,this._refreshTime(),e.insertAfter(this._timeContainer,this._dateContainer),e.setStyle(this._timeContainer,{display:""}),e.squeezeIn(this._timeContainer,{duration:100}),e.squeezeOut(this._dateContainer,{duration:100}).then((t=>{e.detach(this._dateContainer),this.update(),s()}))},a=a=>{a.preventDefault();const n=a.currentTarget,o=e.getDataset(n,"uiAction");let r=this._date?this._date:this._defaultDate;switch(o){case"setDate":if(r=r.setYear(e.getDataset(n,"uiYear"),e.getDataset(n,"uiMonth"),e.getDataset(n,"uiDate")),this._options.multiDate){let e,s;switch(this._minView){case"years":s="year";break;case"months":s="month";break;default:s="day"}e=this._isCurrent(r,{granularity:s})?this._dates.filter((t=>!p(t,r))):this._dates.concat([r]),this._viewDate=r,this._setDates(e,{updateValue:t})}else{if(r=this._clampDate(r),this._hasHours&&!this._isValid(r)){let t=r.startOf("day");const e=r.endOf("day");for(;t.isBefore(e);){if(this._isValid(t)){r=t;break}t=t.add(5,"minutes")}}this._viewDate=r,this._setDate(r,{updateValue:t}),this._hasHours?this._options.sideBySide?s():i():this._options.keepOpen||this._options.modal||this._options.inline||(this.hide(),e.focus(this._node))}break;case"changeView":this._viewMode=e.getDataset(n,"uiView"),e.hasDataset(n,"uiYear")&&(this._viewDate=this._viewDate.setYear(e.getDataset(n,"uiYear"),e.getDataset(n,"uiMonth"),e.getDataset(n,"uiDate"))),this._refreshDate();const a=e.findOne('[data-ui-focus="true"]',this._dateContainer);e.focus(a);break;case"showTime":i();break;case"next":case"prev":const h=e.getDataset(n,"uiAmount")||1,d=e.getDataset(n,"uiUnit");this._viewDate="prev"===o?this._viewDate.sub(h,d):this._viewDate.add(h,d),this._refreshDate();const c=e.findOne(`[data-ui-action="${o}"]`,this._dateContainer);e.focus(c);break;case"close":this.hide(),e.focus(this._node)}},n=()=>{const t=this._viewDate.getYear(),s=this._viewDate.getMonth(),i=this._viewDate.getDate();let a;switch(this._viewMode){case"days":a=`[data-ui-year="${t}"][data-ui-month="${s}"][data-ui-date="${i}"]`;break;case"months":a=`[data-ui-year="${t}"][data-ui-month="${s}"]`;break;case"years":a=`[data-ui-year="${t}"]`}let n=e.findOne(a,this._dateContainer);if(n){const t=e.findOne('[data-ui-focus="true"]',this._dateContainer);e.isSame(n,t)||(e.setAttribute(t,{tabindex:-1}),e.setDataset(t,{uiFocus:!1}),e.setAttribute(n,{tabindex:0}),e.setDataset(n,{uiFocus:!0}))}else this._refreshDate(),n=e.findOne(a,this._dateContainer);e.focus(n)};e.addEventDelegate(this._dateContainer,"click.ui.datetimepicker","[data-ui-action]",(t=>{t.button||a(t)})),e.addEventDelegate(this._dateContainer,"keydown.ui.datetimepicker","[data-ui-action]",(t=>{switch(t.code){case"Enter":case"NumpadEnter":case"Space":return void a(t)}})),e.addEventDelegate(this._dateContainer,"mousedown.ui.datetimepicker",'[data-ui-focus="false"]',(t=>{let s=this._viewDate;s=s.setYear(e.getDataset(t.currentTarget,"uiYear"),e.getDataset(t.currentTarget,"uiMonth"),e.getDataset(t.currentTarget,"uiDate")),s.isSame(this._viewDate)||(this._viewDate=s,n())})),e.addEvent(this._dateContainer,"keydown.ui.datetimepicker",(t=>{let e=this._viewDate;switch(t.code){case"ArrowUp":switch(this._viewMode){case"days":e=t.ctrlKey?e.sub(1,"year"):e.sub(1,"week");break;case"months":e=e.sub(3,"months");break;case"years":e=e.sub(3,"years")}break;case"ArrowRight":switch(this._viewMode){case"days":e=t.ctrlKey?e.add(1,"month"):e.add(1,"day");break;case"months":e=e.add(1,"month");break;case"years":e=e.add(1,"year")}break;case"ArrowDown":switch(this._viewMode){case"days":e=t.ctrlKey?e.add(1,"year"):e.add(1,"week");break;case"months":e=e.add(3,"months");break;case"years":e=e.add(3,"years")}break;case"ArrowLeft":switch(this._viewMode){case"days":e=t.ctrlKey?e.sub(1,"month"):e.sub(1,"day");break;case"months":e=e.sub(1,"month");break;case"years":e=e.sub(1,"year")}break;case"Home":"days"===this._viewMode&&(e=e.startOf("week"));break;case"End":"days"===this._viewMode&&(e=e.endOf("week"));break;case"PageUp":"days"===this._viewMode&&(e=e.sub(1,"month"));break;case"PageDown":"days"===this._viewMode&&(e=e.add(1,"month"));break;default:return}t.preventDefault(),e.isSame(this._viewDate)||this._isBeforeMax(e,{allowSame:!0})&&this._isAfterMin(e,{allowSame:!0})&&(this._viewDate=e,n())}))},g._eventsModal=function(){let t;this._keepDate=!1,e.addEvent(this._modal,"show.ui.modal",(s=>{if(!e.triggerOne(this._node,"show.ui.datetimepicker"))return!1;t=this._options.multiDate?this._dates:this._date})),e.addEvent(this._modal,"shown.ui.modal",(t=>{e.triggerEvent(this._node,"shown.ui.datetimepicker")})),e.addEvent(this._modal,"hide.ui.modal",(t=>{if(!e.triggerOne(this._node,"hide.ui.datetimepicker"))return this._keepDate=!1,!1;this._activeTarget=null,this._keepDate&&(this._options.multiDate?this._setDates(this._dates):this._setDate(this._date))})),e.addEvent(this._modal,"hidden.ui.modal",(s=>{this._keepDate||(this._options.multiDate?this._setDates(t):this._setDate(t),t=null),this._keepDate=!1,e.detach(this._modal),e.triggerEvent(this._node,"hidden.ui.datetimepicker")})),e.addEvent(this._setBtn,"click.ui.modal",(t=>{this._keepDate=!0}))},g._eventsTime=function(){const t=!this._options.modal,s=t=>{const e=t.getHours();return t.setHours(e+(e<12?12:-12))},i=i=>{i.preventDefault();const a=i.currentTarget,n=e.getDataset(a,"uiAction");let o,r=this._date?this._date:this._defaultDate;switch(n){case"setHours":r=r.setHours(e.getDataset(a,"uiHour")),this._timeViewMode=null,this._setDate(r,{updateValue:t}),this._hasMinutes?o='[data-ui-action="changeView"][data-ui-time-view="minutes"]':this._useDayPeriod&&(o='[data-ui-action="togglePeriod"]');break;case"setMinutes":r=r.setMinutes(e.getDataset(a,"uiMinute")),this._timeViewMode=null,this._setDate(r,{updateValue:t}),this._useDayPeriod&&(o='[data-ui-action="togglePeriod"]');break;case"togglePeriod":r=s(r),this._setDate(r,{updateValue:t}),o='[data-ui-action="togglePeriod"]';break;case"changeView":this._timeViewMode=e.getDataset(a,"uiTimeView"),this._refreshTime(),o='[data-ui-focus="true"]';break;case"next":case"prev":const i=e.getDataset(a,"uiUnit"),h="minute"===i?this._options.minuteStepping:1;r="prev"===n?r.sub(h,i):r.add(h,i),this._setDate(r,{updateValue:t}),o=`[data-ui-action="${n}"][data-ui-unit="${i}"]`;break;case"showDate":e.insertBefore(this._dateContainer,this._timeContainer),e.setStyle(this._dateContainer,{display:""}),e.squeezeIn(this._dateContainer,{duration:100}),e.squeezeOut(this._timeContainer,{duration:100}).then((t=>{e.detach(this._timeContainer),this.update();const s=e.findOne('[data-ui-focus="true"]',this._dateContainer);e.focus(s)}));break;case"close":this._date||this._hasDate||this._setDate(this._viewDate),this.hide(),e.focus(this._node)}if(o){const t=e.findOne(o,this._timeContainer);e.focus(t)}};e.addEventDelegate(this._timeContainer,"click.ui.datetimepicker","[data-ui-action]",(t=>{t.button||i(t)})),e.addEventDelegate(this._timeContainer,"keydown.ui.datetimepicker","[data-ui-action]",(a=>{switch(a.code){case"Enter":case"NumpadEnter":case"Space":return void i(a)}const n=e.getDataset(a.currentTarget,"uiAction");let o,r=this._date?this._date:this._defaultDate;switch(n){case"setHours":break;case"togglePeriod":switch(a.code){case"ArrowUp":case"ArrowDown":r=s(r),o=`[data-ui-action="${n}"]`;break;default:return}break;default:let t;switch(n){case"changeView":t=e.getDataset(a.currentTarget,"uiTimeView");break;case"prev":case"next":switch(e.getDataset(a.currentTarget,"uiUnit")){case"hour":t="hours";break;case"minute":t="minutes"}break;default:if(this._timeViewMode)return;t="hours"}switch(a.code){case"ArrowUp":switch(t){case"hours":r=r.add(1,"hour");break;case"minutes":r=r.add(this._options.minuteStepping,"minute")}break;case"ArrowDown":switch(t){case"hours":r=r.sub(1,"hour");break;case"minutes":r=r.sub(this._options.minuteStepping,"minute")}break;default:return}o=`[data-ui-action="changeView"][data-ui-time-view="${t}"]`}const h=!this._date||!r.isSame(this._date);if((h||o)&&a.preventDefault(),h&&this._setDate(r,{updateValue:t}),o){const t=e.findOne(o,this._timeContainer);e.focus(t)}})),e.addEventDelegate(this._timeContainer,"mousedown.ui.datetimepicker",'[data-ui-focus="false"]',(t=>{const s=t.currentTarget,i=e.findOne('[data-ui-focus="true"]',this._timeContainer);e.isSame(s,i)||(e.setAttribute(i,{tabindex:-1}),e.setDataset(i,{uiFocus:!1}),e.setAttribute(s,{tabindex:0}),e.setDataset(s,{uiFocus:!0})),e.focus(s)})),e.addEvent(this._timeContainer,"keydown.ui.datetimepicker",(t=>{let s;switch(this._timeViewMode){case"hours":case"minutes":const i=e.find("[data-ui-focus]",this._timeContainer),a=e.indexOf(i,'[data-ui-focus="true"]')||0;switch(t.code){case"ArrowUp":s=i[a-4];break;case"ArrowRight":s=i[a+1];break;case"ArrowDown":s=i[a+4];break;case"ArrowLeft":s=i[a-1];break;default:return}break;default:return}if(t.preventDefault(),!s)return;const i=e.findOne('[data-ui-focus="true"]',this._timeContainer);e.isSame(s,i)||(e.setAttribute(i,{tabindex:-1}),e.setDataset(i,{uiFocus:!1}),e.setAttribute(s,{tabindex:0}),e.setDataset(s,{uiFocus:!0})),e.focus(s)}))},g._formatDate=function(t){return t?t.format(this._options.format):""},g._formatDates=function(t){return t.map((t=>t.format(this._options.format))).join(this._options.multiDateSeparator)},g._isAfterMin=function(t,{granularity:e=null,allowSame:s=!1}={}){if(!this._minDate)return!0;switch(e){case"day":return s&&p(t,this._minDate)||(c(i=t,a=this._minDate)||f(i,a)&&i.getDate()>a.getDate());case"month":return s&&f(t,this._minDate)||c(t,this._minDate);case"year":return s&&b(t,this._minDate)||u(t,this._minDate);default:return s&&D(t,this._minDate)||function(t,e){return t.getTimestamp()>e.getTimestamp()}(t,this._minDate)}var i,a},g._isBeforeMax=function(t,{granularity:e=null,allowSame:s=!1}={}){if(!this._maxDate)return!0;switch(e){case"day":return s&&p(t,this._maxDate)||(l(i=t,a=this._maxDate)||f(i,a)&&i.getDate()<a.getDate());case"month":return s&&f(t,this._maxDate)||l(t,this._maxDate);case"year":return s&&b(t,this._maxDate)||m(t,this._maxDate);default:return s&&D(t,this._maxDate)||_(t,this._maxDate)}var i,a},g._isCurrent=function(t,{granularity:e=null}={}){let s;switch(e){case"month":s=f;break;case"year":s=b;break;default:s=p}return this._options.multiDate?!!this._dates.find((e=>s(t,e))):this._date&&s(t,this._date)},g._isEditable=function(){return!e.is(this._node,":disabled")&&(this._options.ignoreReadonly||!e.is(this._node,":read-only"))},g._isValid=function(t,{granularity:e="second"}={}){let s;switch(e){case"year":case"month":case"day":s=e}return!(!this._isAfterMin(t,{granularity:s,allowSame:!0})||!this._isBeforeMax(t,{granularity:s,allowSame:!0})||this._options.isValidYear&&!this._options.isValidYear(t)||"year"!==e&&(this._options.isValidMonth&&!this._options.isValidMonth(t)||"month"!==e&&(this._options.isValidDay&&!this._options.isValidDay(t)||"day"!==e&&this._hasHours&&this._options.isValidTime&&!this._options.isValidTime(t))))},g._makeDate=function(t){if(null===t)return t;if(""===(t=`${t}`.trim()))return null;const e=[this._options.format,...this._options.altFormats];for(const s of e)try{const e=i.fromFormat(s,t,this._dateOptions);if(!e.isValid)continue;return this._clampStepping(e)}catch(t){}return null},g._now=function(){return this._clampStepping(i.now(this._dateOptions))},g._parseDate=function(t){if(!t)return null;if(t instanceof i)return i.fromTimestamp(t.getTimestamp(),this._dateOptions);if(e._isString(t))try{return this._makeDate(t)}catch(e){return new i(t,this._dateOptions)}return t instanceof Date?i.fromDate(t,this._dateOptions):e._isNumber(t)?i.fromTimestamp(t,this._dateOptions):e._isArray(t)?i.fromArray(t,this._dateOptions):null},g._parseDates=function(t){return t?t.map((t=>this._parseDate(t))).filter((t=>!!t)):null},g._refresh=function(){if(this._options.showToolbar)if(this._date){if(this._hasYear&&e.setText(this._toolbarYear,this._date.format("yyyy")),this._hasDate?e.setText(this._toolbarDate,this._date.format("MMM d")):this._hasMonth&&e.setText(this._toolbarDate,this._date.format("MMM")),this._hasHours){const i=(t=this._dateOptions.locale,s=this._useDayPeriod,t in r||(r[t]=h(t,{hour:"2-digit",minute:"2-digit"},s)),r[t]);e.setText(this._toolbarTime,this._date.format(i))}}else if(this._hasYear&&e.setText(this._toolbarYear,"-"),this._hasDate?e.setText(this._toolbarDate,"- -"):this._hasMonth&&e.setText(this._toolbarDate,"-"),this._hasHours){const t=this._useDayPeriod?"-:- -":"-:-";e.setText(this._toolbarTime,t)}var t,s;if(this._hasYear&&e.isConnected(this._dateContainer)&&this._refreshDate(),this._hasHours&&e.isConnected(this._timeContainer)&&this._refreshTime(),this._hasYear&&this._hasHours&&!this._options.sideBySide&&this._isEditable()){const t=e.findOne('[data-ui-action="showDate"]',this._showDateTable),s=e.findOne('[data-ui-action="showTime"]',this._showTimeTable);e.setAttribute(t,{tabindex:0}),e.setAttribute(s,{tabindex:0})}},g._refreshDate=function(){switch(e.empty(this._dateContainer),this._viewMode){case"years":this._renderYears();break;case"months":this._renderMonths();break;case"days":this._renderDays()}if(this._hasHours&&!this._options.sideBySide&&(this._options.modal?e.prepend(this._dateContainer,this._showTimeTable):e.append(this._dateContainer,this._showTimeTable)),!this._options.showClose||this._options.modal||this._options.inline||this._hasHours||e.append(this._dateContainer,this._closeTable),!this._isEditable()){const t=e.find("[tabindex]",this._dateContainer);e.setAttribute(t,{tabindex:-1})}this.update(),e.triggerEvent(this._node,"refresh.ui.datetimepicker",{detail:{view:"date",viewMode:this._viewMode,viewDate:this._viewDate}})},g._refreshDisabled=function(){e.is(this._node,":disabled")?e.addClass(this._menuNode,this.constructor.classes.disabled):e.removeClass(this._menuNode,this.constructor.classes.disabled)},g._refreshTime=function(){switch(e.empty(this._timeContainer),this._hasDate&&!this._options.sideBySide&&e.append(this._timeContainer,this._showDateTable),this._timeViewMode){case"hours":this._renderHours();break;case"minutes":this._renderMinutes();break;default:this._renderTime()}if(!this._options.showClose||this._options.modal||this._options.inline||e.append(this._timeContainer,this._closeTable),!this._isEditable()){const t=e.find("[tabindex]",this._timeContainer);e.setAttribute(t,{tabindex:-1})}this.update(),e.triggerEvent(this._node,"refresh.ui.datetimepicker",{detail:{view:"time",viewMode:this._timeViewMode,viewDate:this._viewDate}})},g._resetView=function(){this._viewMode=this._minView,this._timeViewMode=null,this._options.multiDate&&this._dates.length?this._viewDate=this._dates[0]:this._date?this._viewDate=this._date:this._viewDate=this._defaultDate,this._hasDate&&this._hasHours&&!this._options.sideBySide&&(e.detach(this._timeContainer),e.append(this._container,this._dateContainer))},g._render=function(){this._menuNode=e.create("div",{class:this.constructor.classes.menu}),this._options.showToolbar&&this._renderToolbar(),this._container=e.create("div",{class:this.constructor.classes.container}),e.append(this._menuNode,this._container),this._hasYear&&(this._dateContainer=e.create("div",{class:this.constructor.classes.column}),this._hasHours&&!this._options.sideBySide||e.append(this._container,this._dateContainer)),this._hasHours&&(this._timeContainer=e.create("div",{class:this.constructor.classes.column}),this._hasDate&&!this._options.sideBySide||e.append(this._container,this._timeContainer)),this._hasDate&&this._hasHours&&(this._options.sideBySide?this._options.vertical||(e.addClass(this._menuNode,this.constructor.classes.menuWide),e.addClass(this._container,this.constructor.classes.containerColumns)):(this._showTimeTable=this.constructor._createTable({body:t=>{const s=e.create("tr");e.append(t,s);const i=e.create("td",{html:this.constructor.icons.time,class:[this.constructor.classes.action,this.constructor.classes.navigation,this.constructor.classes.spacingNav],attributes:{colspan:7,role:"button",tabindex:0,"aria-label":this.constructor.lang.selectTime},dataset:{uiAction:"showTime"}});e.append(s,i)}}),this._showDateTable=this.constructor._createTable({body:t=>{const s=e.create("tr");e.append(t,s);const i=e.create("td",{html:this.constructor.icons.date,class:[this.constructor.classes.action,this.constructor.classes.navigation,this.constructor.classes.spacingNav],attributes:{colspan:4,role:"button",tabindex:0,"aria-label":this.constructor.lang.selectDate},dataset:{uiAction:"showDate"}});e.append(s,i)}}))),!this._options.showClose||this._options.modal||this._options.inline||(this._closeTable=this.constructor._createTable({body:t=>{const s=e.create("tr");e.append(t,s);const i=e.create("td",{html:this.constructor.icons.close,class:[this.constructor.classes.action,this.constructor.classes.navigation,this.constructor.classes.spacingNav],attributes:{colspan:4,role:"button",tabindex:0,"aria-label":this.constructor.lang.close},dataset:{uiAction:"close"}});e.append(s,i)}})),this._options.modal?e.addClass(this._menuNode,"datetimepicker-modal"):this._options.inline?(e.addClass(this._menuNode,this.constructor.classes.menuInline),e.after(this._node,this._menuNode),e.hide(this._node)):(e.addClass(this._menuNode,this.constructor.classes.menuShadow),e.setAttribute(this._menuNode,{role:"dialog","aria-modal":!0}))},g._renderDays=function(){const t=this._viewDate.startOf("month"),s=this._viewDate.endOf("month");let i=t.startOf("week");const a=s.endOf("week");let n,o;this._isAfterMin(t)&&(n={dataset:{uiAction:"prev",uiUnit:"month"},attributes:{"aria-label":this.constructor.lang.prevMonth}}),this._isBeforeMax(s)&&(o={dataset:{uiAction:"next",uiUnit:"month"},attributes:{"aria-label":this.constructor.lang.nextMonth}});const r=this.constructor._createTable({header:{title:this._viewDate.format("MMMM yyyy"),dataset:{uiAction:"changeView",uiView:"months"},attributes:{"aria-label":this.constructor.lang.selectMonth,"aria-live":"polite"},prev:n,next:o},head:t=>{const s=e.create("tr");e.append(t,s);for(let t=1;t<=7;t++){const a=i.setWeekDay(t),n=e.create("th",{class:this.constructor.classes.days,text:a.dayName("short"),attributes:{scope:"col",abbr:a.dayName("long")}});e.append(s,n)}},body:t=>{let s;const n=this._now();for(;i.isSameOrBefore(a,"day");){1===i.getWeekDay()&&(s=e.create("tr"),e.append(t,s));const a=e.create("td",{text:i.format("dd"),attributes:{role:"button"},dataset:{uiYear:i.getYear(),uiMonth:i.getMonth(),uiDate:i.getDate()}});this._options.ariaFormat&&e.setAttribute(a,{"aria-label":i.format(this._options.ariaFormat)}),e.append(s,a),this._isValid(i,{granularity:"day"})?(e.addClass(a,this.constructor.classes.action),e.setDataset(a,{uiAction:"setDate"})):(e.addClass(a,this.constructor.classes.disabled),e.setAttribute(a,{"aria-disabled":!0})),this._viewDate.isSame(i,{granularity:"day"})?(e.setAttribute(a,{tabindex:0}),e.setDataset(a,{uiFocus:!0})):(e.setAttribute(a,{tabindex:-1}),e.setDataset(a,{uiFocus:!1})),this._isCurrent(i,{granularity:"day"})?(e.addClass(a,this.constructor.classes.active),e.setAttribute(a,{"aria-selected":!0})):this._viewDate.isSame(i,{granularity:"month"})||e.addClass(a,this.constructor.classes.tertiary),n.isSame(i,{granularity:"day"})&&e.addClass(a,this.constructor.classes.today),this._options.renderDay&&this._options.renderDay(i,a),i=i.add(1,"day")}}});e.append(this._dateContainer,r)},g._renderHours=function(){const t=this._date?this._date:this._defaultDate;let s=t.startOf("day");const i=t.endOf("day"),a=this.constructor._createTable({borderless:!0,body:a=>{const n=e.create("tr");e.append(a,n);const o=e.create("td",{class:this.constructor.classes.rowContainer,attributes:{colspan:7}});e.append(n,o);const r=e.create("div",{class:this.constructor.classes.row});for(e.append(o,r);s.isSameOrBefore(i,{granularity:"hour"});){const i=s.format("HH"),a=e.create("div",{text:i,class:this.constructor.classes.hourColumn,attributes:{"aria-label":i}});e.append(r,a),this._isValid(s,{granularity:"hour"})?(e.addClass(a,this.constructor.classes.action),e.setDataset(a,{uiAction:"setHours",uiHour:s.getHours()}),e.setAttribute(a,{role:"button "})):e.addClass(a,this.constructor.classes.disabled),t.isSame(s,{granularity:"hour"})?(e.setAttribute(a,{tabindex:0}),e.setDataset(a,{uiFocus:!0})):(e.setAttribute(a,{tabindex:-1}),e.setDataset(a,{uiFocus:!1})),this._date&&this._date.isSame(s,{granularity:"hour"})&&(e.addClass(a,this.constructor.classes.active),e.setAttribute(a,{"aria-selected":!0})),s=s.add(1,"hour")}}});e.append(this._timeContainer,a)},g._renderMinutes=function(){const t=this._date?this._date:this._defaultDate;let s=t.startOf("hour");const i=t.endOf("hour"),a=this.constructor._createTable({borderless:!0,body:a=>{const n=e.create("tr");e.append(a,n);const o=e.create("td",{class:this.constructor.classes.rowContainer,attributes:{colspan:7}});e.append(n,o);const r=e.create("div",{class:this.constructor.classes.row});e.append(o,r);const h=1==this._options.minuteStepping?5:this._options.minuteStepping;for(;s.isSameOrBefore(i,{granularity:"minute"});){const i=s.format("mm"),a=e.create("span",{text:i,class:this.constructor.classes.timeColumn});e.append(r,a),this._isValid(s,{granularity:"minute"})?(e.addClass(a,this.constructor.classes.action),e.setDataset(a,{uiAction:"setMinutes",uiMinute:s.getMinutes()}),e.setAttribute(a,{role:"button","aria-label":i})):e.addClass(a,this.constructor.classes.disabled),t.isSame(s,{granularity:"minute"})?(e.setAttribute(a,{tabindex:0}),e.setDataset(a,{uiFocus:!0})):(e.setAttribute(a,{tabindex:-1}),e.setDataset(a,{uiFocus:!1})),this._date&&this._date.isSame(s,{granularity:"minute"})&&(e.addClass(a,this.constructor.classes.active),e.setAttribute(a,{"aria-selected":!0})),s=s.add(h,"minutes")}if(!e.findOne('[data-ui-focus="true"]',r)){const t=e.findOne('[data-ui-focus="false"]',r);e.setAttribute(t,{tabindex:0}),e.setDataset(t,{uiFocus:!0})}}});e.append(this._timeContainer,a)},g._renderModal=function(){this._modal=e.create("div",{class:this.constructor.classes.modal,attributes:{tabindex:-1,role:"dialog","aria-modal":!0}});const t=e.create("div",{class:this.constructor.classes.modalDialog});e.append(this._modal,t);const s=e.create("div",{class:this.constructor.classes.modalContent});e.append(t,s);const i=e.create("div",{class:this.constructor.classes.modalHeader});let a;e.append(s,i),a=this._hasHours?this._hasDate?this.constructor.lang.selectDateTime:this.constructor.lang.selectTime:this.constructor.lang.selectDate;const n=e.create("h6",{class:this.constructor.classes.modalTitle,text:a});e.append(i,n);const o=e.create("div",{class:this.constructor.classes.modalBody});e.append(s,o),e.append(o,this._menuNode);const r=e.create("div",{class:this.constructor.classes.modalBtnContainer});e.append(o,r);const h=e.create("button",{class:this.constructor.classes.modalBtnSecondary,text:this.constructor.lang.cancel,attributes:{type:"button","data-ui-dismiss":"modal"}});e.append(r,h),this._setBtn=e.create("button",{class:this.constructor.classes.modalBtnPrimary,text:this.constructor.lang.set,attributes:{type:"button","data-ui-dismiss":"modal","data-ui-set-color":"true"}}),e.append(r,this._setBtn)},g._renderMonths=function(){const t=this._viewDate.startOf("year"),s=this._viewDate.endOf("year");let i,a,n=t;this._isAfterMin(t)&&(i={dataset:{uiAction:"prev",uiUnit:"year"},attributes:{"aria-label":this.constructor.lang.prevYear}}),this._isBeforeMax(s)&&(a={dataset:{uiAction:"next",uiUnit:"year"},attributes:{"aria-label":this.constructor.lang.nextYear}});const o=this.constructor._createTable({header:{title:this._viewDate.format("yyyy"),wide:!0,dataset:{uiAction:"changeView",uiView:"years"},attributes:{"aria-label":this.constructor.lang.selectYear},prev:i,next:a},body:t=>{const i=e.create("tr");e.append(t,i);const a=e.create("td",{class:this.constructor.classes.rowContainer,attributes:{colspan:7}});e.append(i,a);const o=e.create("div",{class:this.constructor.classes.row});for(e.append(a,o);n.isSameOrBefore(s,{granularity:"month"});){const t=e.create("div",{text:n.format("MMM"),class:this.constructor.classes.dateColumn});e.append(o,t),this._viewDate.isSame(n,{granularity:"month"})?(e.setAttribute(t,{tabindex:0}),e.setDataset(t,{uiFocus:!0})):(e.setAttribute(t,{tabindex:-1}),e.setDataset(t,{uiFocus:!1})),this._isCurrent(n,{granularity:"month"})&&e.addClass(t,this.constructor.classes.active),this._isValid(n,{granularity:"month"})?(e.addClass(t,this.constructor.classes.action),"months"===this._minView?e.setDataset(t,{uiAction:"setDate",uiYear:n.getYear(),uiMonth:n.getMonth()}):e.setDataset(t,{uiAction:"changeView",uiView:"days",uiYear:n.getYear(),uiMonth:n.getMonth()})):e.addClass(t,this.constructor.classes.disabled),this._options.renderMonth&&this._options.renderMonth(n,t),n=n.add(1,"month")}}});e.append(this._dateContainer,o)},g._renderTime=function(){const t=this._date?this._date:this._defaultDate,s=this.constructor._createTable({borderless:!0,body:s=>{const i=(100-3*(this._hasHours+this._hasMinutes-1))/(this._hasHours+this._hasMinutes+this._useDayPeriod),a=e.create("tr");e.append(s,a);const n=e.create("tr");e.append(s,n);const o=e.create("tr");if(e.append(s,o),this._hasHours){let e,s;const r=t.add(1,"hour");this._isValid(r,{granularity:"hour"})&&(e={dataset:{uiAction:"next",uiUnit:"hour"},attributes:{"aria-label":this.constructor.lang.incrementHour}});const h=t.sub(1,"hour");this._isValid(h,{granularity:"hour"})&&(s={dataset:{uiAction:"prev",uiUnit:"hour"},attributes:{"aria-label":this.constructor.lang.decrementHour}}),this.constructor._renderTimeColumn({increment:e,select:{text:t.format(this._useDayPeriod?"hh":"HH"),dataset:{uiAction:"changeView",uiTimeView:"hours"},attributes:{"aria-label":this.constructor.lang.selectHour}},decrement:s,cellWidth:i,upTr:a,timeTr:n,downTr:o})}if(this._hasHours&&this._hasMinutes&&this.constructor._renderTimeSeparator({separatorWidth:3,upTr:a,timeTr:n,downTr:o}),this._hasMinutes){let e,s;const r=t.getMinutes(),h=Math.min(r+this._options.minuteStepping,60),d=t.setMinutes(h);this._isValid(d,{granularity:"minute"})&&(e={dataset:{uiAction:"next",uiUnit:"minute"},attributes:{"aria-label":this.constructor.lang.incrementMinute}});const c=t.sub(this._options.minuteStepping,"minute");this._isValid(c,{granularity:"minute"})&&(s={dataset:{uiAction:"prev",uiUnit:"minute"},attributes:{"aria-label":this.constructor.lang.decrementMinute}}),this.constructor._renderTimeColumn({increment:e,select:{text:t.format("mm"),dataset:{uiAction:"changeView",uiTimeView:"minutes"},attributes:{"aria-label":this.constructor.lang.selectMinute}},decrement:s,cellWidth:i,upTr:a,timeTr:n,downTr:o})}if(this._useDayPeriod){const s=e.create("td",{style:{width:`${i}%`}});e.append(a,s);const r=e.create("td");e.append(n,r);const h=e.create("span",{text:t.format("aa").toUpperCase(),class:this.constructor.classes.periodButton,attributes:{role:"button",tabindex:0,"aria-label":this.constructor.lang.togglePeriod}}),d=t.getHours(),c=t.setHours(d+(d<12?12:-12));this._isValid(c)?e.setDataset(h,{uiAction:"togglePeriod"}):(e.addClass(h,this.constructor.classes.disabled),e.setAttribute(h,{"aria-disabled":!0})),e.append(r,h);const u=e.create("td");e.append(o,u)}}});e.append(this._timeContainer,s)},g._renderToolbar=function(){const t=e.create("div",{class:this.constructor.classes.toolbarRow});if(this._options.modal||e.addClass(t,this.constructor.classes.toolbarPadding),e.append(this._menuNode,t),this._hasYear){const s=e.create("div");e.append(t,s),this._toolbarYear=e.create("div",{class:this.constructor.classes.toolbarYear}),e.append(s,this._toolbarYear),this._hasMonth&&(this._toolbarDate=e.create("div",{class:this.constructor.classes.toolbarDate}),e.append(s,this._toolbarDate))}if(this._hasHours){const s=e.create("div");e.append(t,s),this._toolbarTime=e.create("span",{class:this.constructor.classes.toolbarTime}),e.append(s,this._toolbarTime)}},g._renderYears=function(){const t=this._viewDate.getYear(),s=t-t%10,i=s+9,a=this._viewDate.setYear(s).startOf("year"),n=this._viewDate.setYear(i).endOf("year");let o=a.sub(1,"year");const r=n.add(1,"year");let h,d;this._isAfterMin(a)&&(h={dataset:{uiAction:"prev",uiUnit:"years",uiAmount:10},attributes:{"aria-label":this.constructor.lang.prevDecade}}),this._isBeforeMax(n)&&(d={dataset:{uiAction:"next",uiUnit:"years",uiAmount:10},attributes:{"aria-label":this.constructor.lang.nextDecade}});const c=this.constructor._createTable({header:{title:`${a.format("yyyy")} - ${n.format("yyyy")}`,wide:!0,prev:h,next:d},body:t=>{const a=e.create("tr");e.append(t,a);const n=e.create("td",{class:this.constructor.classes.rowContainer,attributes:{colspan:7}});e.append(a,n);const h=e.create("div",{class:this.constructor.classes.row});for(e.append(n,h);o.isSameOrBefore(r,"year");){const t=o.getYear(),a=o.format("yyyy"),n=e.create("div",{text:a,class:this.constructor.classes.dateColumn,attributes:{"aria-label":a}});e.append(h,n),this._viewDate.isSame(o,{granularity:"year"})?(e.setAttribute(n,{tabindex:0}),e.setDataset(n,{uiFocus:!0})):(e.setAttribute(n,{tabindex:-1}),e.setDataset(n,{uiFocus:!1})),this._isCurrent(o,{granularity:"year"})?e.addClass(n,this.constructor.classes.active):(t<s||t>i)&&e.addClass(n,this.constructor.classes.tertiary),this._isValid(o,{granularity:"year"})?(e.addClass(n,this.constructor.classes.action),"years"===this._minView?e.setDataset(n,{uiAction:"setDate",uiYear:t}):e.setDataset(n,{uiAction:"changeView",uiView:"months",uiYear:t}),e.setAttribute(n,{role:"button "})):e.addClass(n,this.constructor.classes.disabled),this._options.renderYear&&this._options.renderYear(o,n),o=o.add(1,"year")}}});e.append(this._dateContainer,c)},g._setDate=function(t,{updateValue:s=!0}={}){if(!this._isEditable())return;t&&(t=this._clampStepping(t)),t&&!this._isValid(t)&&(t=null);const i=this._date;this._date=t,this._refresh();const a=e.getValue(this._node),n=this._formatDate(t);s&&a!==n&&(this._updateValue(),e.triggerEvent(this._node,"change.ui.datetimepicker",{data:{skipUpdate:!0},detail:{old:i,new:this._date}}))},g._setDates=function(t,{updateValue:s=!0}={}){if(!this._isEditable())return;t=t.filter((t=>this._isValid(t))).sort(((t,e)=>_(t,e)?-1:1));const i=this._dates;this._dates=t,this._refresh();const a=e.getValue(this._node),n=this._formatDates(t);s&&a!==n&&(this._updateValue(),e.triggerEvent(this._node,"change.ui.datetimepicker",{data:{skipUpdate:!0},detail:{old:i,new:this._dates.slice()}}))},g._updateValue=function(){let t;t=this._options.multiDate?this._formatDates(this._dates):this._formatDate(this._date),e.setValue(this._node,t)},s.initComponent("datetimepicker",d),e.addEvent(document,"mousedown.ui.datetimepicker",(t=>{const i=s.getClickTarget(t),a=e.find(".datetimepicker:not(.datetimepicker-inline):not(.datetimepicker-modal)");for(const t of a){const s=e.getData(t,"input"),a=d.init(s);e.isSame(a._node,i)||e.isSame(a._menuNode,i)||e.hasDescendent(a._menuNode,i)||a.hide()}}),{capture:!0}),e.addEvent(document,"keydown.ui.datetimepicker",(t=>{if("Escape"!==t.code)return;let s=!1;const i=e.find(".datetimepicker:not(.datetimepicker-inline):not(.datetimepicker-modal)");for(const[a,n]of i.entries()){const i=e.getData(n,"input"),o=d.init(i);s||(s=!0,t.stopPropagation()),o.hide(),0==a&&e.focus(i)}}),{capture:!0}),t.DateTimePicker=d}));